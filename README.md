# Мультиагентная рекомендательная система на GigaChat

Демонстрационный проект мультиагентной системы рекомендаций товаров с использованием Sber GigaChat API. В системе участвуют агенты-покупатели и агенты-товары, которые общаются через агент-рынок. Проект симулирует пользовательские сессии, возвращает ранжированный список рекомендаций и рассчитывает CTR (клик-сквозной рейтинг). 

## Технологии

- Python, FastAPI
- React
- Sber GigaChat API
- Docker, docker-compose

## Установка и запуск

1. Убедитесь, что установлены **Docker** и **docker-compose**.
2. Склонируйте репозиторий и перейдите в его папку:



## Установка и запуск

1. Установите Docker и docker‑compose.
2. Склонируйте репозиторий проекта.
3. Создайте файл `.env` в корне проекта со следующим содержимым (используйте ваши реальные креденшалы от Сбера):
   ```dotenv
   GIGA_AUTH_HEADER=MmI5ZDBkMWUtOGQ4MC00MDlhLTk2MDAtMWNhYzJkNzRjOTA3OjAzYjM2OTQyLTQ0OTctNDY5OC1hNDY1LTRmNjY3M2JhNjQ3Mw==
   GIGA_CLIENT_ID=2b9d0d1e-8d80-409a-960a-9600-1cac2d74c907
   GIGA_CLIENT_SECRET=03b36942-4497-4698-a465-4f6673ba6473
   GIGA_SCOPE=GIGACHAT_API_PERS


BuyerAgent (agents/buyer_agent.py)

Представляет пользователя (покупателя) с набором предпочтительных категорий.

Метод choose_item моделирует выбор одного товара из списка рекомендаций.

ItemAgent (agents/item_agent.py)

Представляет товар с уникальным ID, названием, категорией и ценой.

Не принимает решений самостоятельно, но участвует в переговорном протоколе через GigaChat.

MarketplaceAgent (agents/marketplace_agent.py)

Центральный агент-арбитр: получает предпочтения BuyerAgent и список ItemAgent.

Вызывает giga_integration.negotiation_protocol.get_recommendations, передавая туда информацию об агентах-покупателе и агентах-товарах.

Собирает от GigaChat список ID рекомендованных товаров, формирует итоговый список объектов ItemAgent.

Environment / Simulator (environment/simulator.py)

Организует несколько итераций (сессий) взаимодействия BuyerAgent и MarketplaceAgent.

Считает показы (impressions) и клики, передаёт эти данные в метрику CTR.

GigaChat-интеграция (giga_integration/negotiation_protocol.py)

Формирует текстовый prompt, описывающий состояние агентов: предпочтения покупателя и атрибуты товаров.

Отправляет prompt в Sber GigaChat API, получает JSON‑список рекомендованных ID.

Если API недоступно, использует локальный fallback (фильтрация по категориям и сортировка по цене).

Мониторинг (Prometheus + Grafana)

FastAPI экспортирует метрики (simulate_requests_total, simulate_request_latency_seconds) на /metrics.

Prometheus опрашивает этот endpoint и хранит время и количество запросов.

Grafana визуализирует метрики на дашборде MAS App Monitoring.

6.2 Поток взаимодействия (Sequence)

1. Пользователь (BuyerAgent) генерируется симулятором со случайными предпочтениями.
2. MarketplaceAgent запрашивает у GigaChat рекомендации, передавая BuyerAgent.preferences и характеристики ItemAgent.
3. GigaChat возвращает список ID топ‑3 товаров.
4. MarketplaceAgent собирает объекты ItemAgent по этим ID и отдаёт их BuyerAgent.
5. BuyerAgent выбирает первый товар (choose_item).
6. Simulator фиксирует показ и клик, обновляет CTR.
7. FastAPI отдаёт результат браузеру или curl.
8. Prometheus опрашивает `/metrics`, Grafana отображает данные.

6.3 Где мультиагентность?

Система состоит из нескольких агентов (BuyerAgent, множество ItemAgent, MarketplaceAgent).

Переговоры между агентами происходят через GigaChat: товары «конкурируют» за внимание покупателя, покупатель оценивает предложения.

Координация: MarketplaceAgent выступает координатором, собирает ставки (рекомендации) от ItemAgent и определяет итоговый порядок.

6.4 Как расширить число агентов?

Добавить агентов-рекламодателей, которые влияют на цену товаров (доп. ставка за показ).

Ввести агент-аналитик, отслеживающий эффективность стратегий и перенастраивающий параметры GigaChat‑prompt.

Подключить агентов-пользователей с разными типами поведения (экономные, люксовые) для A/B‑тестов.

Таким образом, ваш проект уже реализует мультиагентный подход и легко масштабируется новыми ролями агентности.

